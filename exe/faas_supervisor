#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative "../lib/faas_supervisor"

Async do
  openfaas_url = ENV.fetch("OPENFAAS_URL")
  openfaas_username = ENV.fetch("OPENFAAS_USERNAME")
  openfaas_password = ENV.fetch("OPENFAAS_PASSWORD")
  prometheus_url = ENV.fetch("PROMETHEUS_URL", "127.0.0.1:9090")
  update_interval = ENV.fetch("SUPERVISOR_UPDATE_INTERVAL", "10")

  app = FaasSupervisor::Application.new(
    openfaas_url:,
    openfaas_username:,
    openfaas_password:,
    prometheus_url:,
    update_interval:
  )

  app.run
  app.wait
end
